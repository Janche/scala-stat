+----------------------------------------------+--------------------------+-------------------------------+----------------------------+-----------------------------+----------------------------+----------------------------+-------------------------------+----------------------------------+------------------------------+--------------------------------+--------------------------+-----------------------------------+----------------------------+--------------------------------+---------------------------------+--------------------------------+------------------------------+-----------------------------+---------------------------------+---------------------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+------------------------------+-----------------------+----------------------------+-------------------------+-------------------------+--------------------------+------------------------+
|            inde_h5_event_pre.udid            | inde_h5_event_pre.appid  | inde_h5_event_pre.devicetype  | inde_h5_event_pre.channel  | inde_h5_event_pre.usertype  | inde_h5_event_pre.sceneid  | inde_h5_event_pre.version  | inde_h5_event_pre.actiontype  | inde_h5_event_pre.localtimezone  | inde_h5_event_pre.localtime  | inde_h5_event_pre.sessionflag  | inde_h5_event_pre.level  | inde_h5_event_pre.customdotevent  | inde_h5_event_pre.groupid  | inde_h5_event_pre.confversion  | inde_h5_event_pre.actionsource  | inde_h5_event_pre.devicemodel  | inde_h5_event_pre.osversion  | inde_h5_event_pre.currency  | inde_h5_event_pre.purchasecost  | inde_h5_event_pre.purchaseitem  | inde_h5_event_pre.v1  | inde_h5_event_pre.v2  | inde_h5_event_pre.v3  | inde_h5_event_pre.v4  | inde_h5_event_pre.v5  | inde_h5_event_pre.v6  | inde_h5_event_pre.v7  | inde_h5_event_pre.v8  | inde_h5_event_pre.timestamp  | inde_h5_event_pre.ip  | inde_h5_event_pre.country  | inde_h5_event_pre.city  | inde_h5_event_pre.year  | inde_h5_event_pre.month  | inde_h5_event_pre.day  |
+----------------------------------------------+--------------------------+-------------------------------+----------------------------+-----------------------------+----------------------------+----------------------------+-------------------------------+----------------------------------+------------------------------+--------------------------------+--------------------------+-----------------------------------+----------------------------+--------------------------------+---------------------------------+--------------------------------+------------------------------+-----------------------------+---------------------------------+---------------------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+------------------------------+-----------------------+----------------------------+-------------------------+-------------------------+--------------------------+------------------------+
| Ga_htBZhN9p7-LQEqUijzTSvd1lXGxhFa8IOTuhBqXs  | com.libii.crushallh5     | Android                       | VIVO_H5                    | new                         | -1                         | 1.0.0                      | customDot                     | GMT+08:00                        | 2021-09-13 00:00:00          | NULL                           | 9                        | nativebanner                      | 1001                       | NULL                           | NULL                            | V2057A                         | Android 10                   | NULL                        | NULL                            | NULL                            | 1                     | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | 1631462400814                | 171.111.54.23         | CN                         | Nanning                 | 2021                    | 9                        | 13                     |
| Ga_htBZhN9p7-LQEqUijzTSvd1lXGxhFa8IOTuhBqXs  | com.libii.crushallh5     | Android                       | VIVO_H5                    | new                         | -1                         | 1.0.0                      | customDot                     | GMT+08:00                        | 2021-09-13 00:00:00          | NULL                           | 9                        | nativebanner                      | 1001                       | NULL                           | NULL                            | V2057A                         | Android 10                   | NULL                        | NULL                            | NULL                            | 2                     | 1                     | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | 1631462400855                | 171.111.54.23         | CN                         | Nanning                 | 2021                    | 9                        | 13                     |
| nvE8PcPC5joeZhcgSSQ0m10Y5FZi789wr5LUzulxEpM  | H5G35                    | Android                       | VIVO_H5                    | old                         | 1000                       | 0.4.4                      | sessionIn                     | GMT+08:00                        | 2021-09-13 00:00:04          | 5                              | 5                        | NULL                              | 0                          | 440                            | NULL                            | NULL                           | NULL                         | NULL                        | NULL                            | NULL                            | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | 1631462405256                | 112.97.55.150         | CN                         | Shenzhen                | 2021                    | 9                        | 13                     |
| 1115665873                                   | com.libii.h5g200         | Android                       | OPPO_H5                    | new                         | -1                         | 1.0.7                      | customDot                     | GMT+08:00                        | 2021-09-13 00:00:06          | NULL                           | 2                        | nativebanner                      | 1071                       | NULL                           | NULL                            | PBAM00                         | Android 8.1.0                | NULL                        | NULL                            | NULL                            | 2                     | 1                     | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | 1631462406625                | 221.192.180.214       | CN                         | Beijing                 | 2021                    | 9                        | 13                     |
| UaIK-MkXdM3YjyU8U05zYVvjGy-5zcBa5MzhizkbkOY  | com.libii.crushallh5     | Android                       | VIVO_H5                    | new                         | -1                         | 1.0.0                      | customDot                     | GMT+08:00                        | 2021-09-13 00:00:14          | NULL                           | 1                        | noblePack                         | 1001                       | NULL                           | NULL                            | V1930A                         | Android 9                    | NULL                        | NULL                            | NULL                            | 0                     | 1                     | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | NULL                  | 1631462415377                | 183.93.3.155          | CN                         | Wuhan                   | 2021                    | 9                        | 13                     |
+----------------------------------------------+--------------------------+-------------------------------+----------------------------+-----------------------------+----------------------------+----------------------------+-------------------------------+----------------------------------+------------------------------+--------------------------------+--------------------------+-----------------------------------+----------------------------+--------------------------------+---------------------------------+--------------------------------+------------------------------+-----------------------------+---------------------------------+---------------------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+-----------------------+------------------------------+-----------------------+----------------------------+-------------------------+-------------------------+--------------------------+------------------------+

# hvie 建表语句
CREATE TABLE `dwd.inde_h5_dau`(
   `udid` string,
   `channel` string,
   `appid` string,
   `date` Int,
   `timestamp` bigint,
   `deviceType` string,
   `actionType` string,
   `version` string,
   `country` string,
   `sessionFlag` int,
   `groupId` bigint,
   `userType` string,
   `level` string,
   `customDotEvent` string,
   `sceneId` string)
 PARTITIONED BY (
   `year` int,
   `month` int,
   `day` int)
 STORED AS PARQUET
 LOCATION
   'hdfs://statisticservice/warehouse/tablespace/managed/hive/dwd.db/inde_h5_dau'
 TBLPROPERTIES('parquet.compression'='SNAPPY');


 # dnu
 drop table `dwd.inde_h5_dnu`;create table if not exists `dwd.inde_h5_dnu`(
    `udid` string,
    `channel` string,
    `appid` string,
    `date` Int,
    `timestamp` bigint,
    `deviceType` string,
    `actionType` string,
    `version` string,
    `country` string,
    `sessionFlag` int,
    `groupId` bigint,
    `userType` string,
    `level` string,
    `customDotEvent` string,
    `sceneId` string)
  PARTITIONED BY (
    `year` int,
    `month` int,
    `day` int)
  STORED AS PARQUET
  LOCATION
    'hdfs://statisticservice/warehouse/tablespace/managed/hive/dwd.db/inde_h5_dnu'
  TBLPROPERTIES(
     'auto.purge'='true',
     'immutable'='false',
     'transactional'='false');

# dau
drop table `dwd.inde_h5_dau`;create table if not exists `dwd.inde_h5_dau`(
   `udid` string,
   `channel` string,
   `appid` string,
   `date` Int,
   `timestamp` bigint,
   `deviceType` string,
   `actionType` string,
   `version` string,
   `country` string,
   `sessionFlag` int,
   `groupId` bigint,
   `userType` string,
   `level` string,
   `customDotEvent` string,
   `sceneId` string)
 PARTITIONED BY (
   `year` int,
   `month` int,
   `day` int)
 STORED AS PARQUET
 LOCATION
   'hdfs://statisticservice/warehouse/tablespace/managed/hive/dwd.db/inde_h5_dau'
 TBLPROPERTIES(
    'auto.purge'='true',
    'immutable'='false',
    'transactional'='false');
  /**
      'auto.purge'='true' 删除或者覆盖的数据会不经过回收站，直接被删除
      'immutable'='false' 属性为true时，若表中无数据时可以insert数据，但是当表已经有数据时，insert操作会失败，防止意外更新
      'transactional'='false' 当此属性为true时，依旧不能overwrite覆盖更新，只能insert-only
   */

# 上面的方式创建表依旧不能覆盖写入，最好的方式就是采用 overwrite + saveAsTable,自动创建表，然后改成 overwrite + insertInto 就可以覆盖写入分区数据了
# create_table.sql中的建表方式可以，分区覆盖写入

spark-submit --master yarn --deploy-mode client \
--driver-memory 1g --num-executors 2 --executor-cores 2 \
--executor-memory 2g --class com.libii.stat.controller.GameController \
--queue default /root/spark_jar/scala-stat-1.0-SNAPSHOT-jar-with-dependencies.jar 30

# 出现的异常
Caused by: MetaException(message:Your client does not appear to support insert-only tables. To skip capability checks, please set metastore.client.capability.check to false.